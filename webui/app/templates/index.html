<!--
Home page template for saturn-arc WebUI
Author: Cascade (AI assistant)

Lets users:
- Select dataset (training/evaluation)
- Search/filter tasks in ARC-AGI-2/data
- View a simple table of tasks
Phase 0: Discovery only; run action to be added in Phase 1.
-->
{% extends "base.html" %}
{% block content %}
  <div class="row">
    <div class="col-12 col-lg-10">
      <h1 class="h3 mb-3">Browse ARC Tasks</h1>
      <form class="row gy-2 gx-2 align-items-center" onsubmit="return false;">
        <div class="col-sm-4">
          <label for="dataset" class="form-label">Dataset</label>
          <select id="dataset" class="form-select" onchange="loadTasks()">
            {% for ds in datasets %}
            <option value="{{ ds }}">{{ ds }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-sm-4">
          <label for="search" class="form-label">Search</label>
          <input id="search" type="text" class="form-control" placeholder="e.g., 2ba387bc" oninput="debouncedLoad()"/>
        </div>
        <div class="col-sm-2">
          <label for="limit" class="form-label">Limit</label>
          <input id="limit" type="number" class="form-control" value="100" min="1" max="1000" onchange="loadTasks()"/>
        </div>
        <div class="col-sm-2">
          <label for="offset" class="form-label">Offset</label>
          <input id="offset" type="number" class="form-control" value="0" min="0" onchange="loadTasks()"/>
        </div>
      </form>

      <div class="mt-3">
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th style="width:2rem;"></th>
              <th>Task Name</th>
              <th>Path</th>
            </tr>
          </thead>
          <tbody id="tasksBody">
            <tr><td colspan="3">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="d-flex gap-2">
        <button class="btn btn-primary" disabled title="Coming in Phase 1">Run Selected</button>
        <button class="btn btn-outline-secondary" onclick="loadTasks()">Refresh</button>
      </div>
    </div>
  </div>

  <script>
    let debounceTimer;
    function debouncedLoad() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(loadTasks, 250);
    }

    async function loadTasks() {
      const dataset = document.getElementById('dataset').value;
      const search = document.getElementById('search').value;
      const limit = document.getElementById('limit').value;
      const offset = document.getElementById('offset').value;

      const params = new URLSearchParams({ dataset, limit, offset });
      if (search && search.trim().length > 0) params.append('search', search.trim());

      const body = document.getElementById('tasksBody');
      body.innerHTML = '<tr><td colspan="3">Loading...</td></tr>';

      try {
        const res = await fetch(`/api/tasks?${params.toString()}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const tasks = await res.json();
        if (!Array.isArray(tasks) || tasks.length === 0) {
          body.innerHTML = '<tr><td colspan="3" class="text-muted">No tasks found</td></tr>';
          return;
        }
        body.innerHTML = tasks.map(t => `
          <tr>
            <td><input type="checkbox"/></td>
            <td><code>${t.name}</code></td>
            <td><small>${t.path}</small></td>
          </tr>
        `).join('');
      } catch (err) {
        body.innerHTML = `<tr><td colspan="3" class="text-danger">Error: ${err.message}</td></tr>`;
      }
    }

    // Initial load
    window.addEventListener('DOMContentLoaded', loadTasks);
  </script>
{% endblock %}
